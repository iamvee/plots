<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Player</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            transition: margin-right 0.3s ease;
        }
        
        .main-content.sidebar-open {
            margin-right: 400px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 1000px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .sidebar {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            transition: right 0.3s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar.open {
            right: 0;
        }
        
        .sidebar-toggle {
            position: fixed;
            right: 20px;
            top: 20px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            color: white;
            padding: 12px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            transition: all 0.3s ease;
        }
        
        .sidebar-toggle:hover {
            transform: scale(1.1);
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .sidebar-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #87ceeb;
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }
        
        .config-section {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .config-section h3 {
            margin: 0 0 15px 0;
            color: #87ceeb;
            font-size: 1.1em;
        }
        
        .json-editor {
            position: relative;
        }
        
        textarea {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            resize: vertical;
            line-height: 1.4;
        }
        
        textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .json-error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 0.8em;
            display: none;
        }
        
        .json-valid {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #4caf50;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 0.8em;
            display: none;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #87ceeb;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: white;
            padding: 8px;
            font-size: 0.9em;
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .audio-section {
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .audio-title {
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #87ceeb;
        }
        
        .audio-location {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
            font-style: italic;
        }
        
        .audio-controls-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .play-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 60px;
        }
        
        .play-button:hover {
            transform: translateY(-1px);
        }
        
        .play-button.playing {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }
        
        .autoplay-indicator {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        audio {
            width: 100%;
            margin-bottom: 8px;
            border-radius: 5px;
            height: 35px;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 4px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button.config-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            width: 100%;
            margin-bottom: 10px;
        }
        
        button.export-btn {
            background: linear-gradient(45deg, #9c27b0, #673ab7);
        }
        
        button.add-btn {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }
        
        .status {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .info {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .audio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .volume-display {
            min-width: 40px;
            text-align: right;
            font-size: 0.8em;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        .button-group button {
            flex: 1;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .modal-content {
            background: rgba(30, 60, 114, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            color: #87ceeb;
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="main-content" id="mainContent">
        <div class="container">
            <div class="controls">
                <button onclick="playAll()">▶️ Play All</button>
                <button onclick="pauseAll()">⏸️ Pause All</button>
                <button onclick="stopAll()">⏹️ Stop All</button>
            </div>
            
            <div class="audio-grid" id="audioContainer">
                <!-- Audio sections will be generated here -->
            </div>
            
            <div class="status" id="status">
                Configure your stations using the settings panel on the right
            </div>
            
            <div class="info">
                🛩️
            </div>
        </div>
    </div>

    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">⚙️</button>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">Station Configuration</div>
        </div>
        
        <div class="sidebar-content">
            <div class="config-section">
                <h3>JSON Editor</h3>
                <div class="json-editor">
                    <textarea id="stationConfig" placeholder="Enter JSON configuration..."></textarea>
                    <div id="jsonError" class="json-error"></div>
                    <div id="jsonValid" class="json-valid">✅ JSON is valid</div>
                </div>
                <div class="button-group" style="margin-top: 15px;">
                    <button class="config-btn" onclick="loadStations()">🔄 Load</button>
                    <button class="config-btn" onclick="resetToDefault()">↻ Reset</button>
                </div>
            </div>
            
            <div class="config-section">
                <h3>Station Management</h3>
                <button class="add-btn" onclick="showAddStationModal()">➕ Add New Station</button>
                <button class="export-btn" onclick="exportConfig()" style="margin-top: 10px;">💾 Export JSON</button>
            </div>
        </div>
    </div>

    <!-- Add Station Modal -->
    <div class="modal" id="addStationModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add New Station</div>
                <button class="close-btn" onclick="hideAddStationModal()">&times;</button>
            </div>
            <form id="addStationForm">
                <div class="form-group">
                    <label for="stationTitle">Title *</label>
                    <input type="text" id="stationTitle" placeholder="e.g., Houston Tower" required>
                </div>
                
                <div class="form-group">
                    <label for="stationAddress">Stream Address *</label>
                    <input type="url" id="stationAddress" placeholder="https://s1-fmt2.liveatc.net/..." required>
                </div>
                
                <div class="form-group">
                    <label for="stationCountry">Country</label>
                    <input type="text" id="stationCountry" placeholder="e.g., United States">
                </div>
                
                <div class="form-group">
                    <label for="stationState">State/Province</label>
                    <input type="text" id="stationState" placeholder="e.g., Texas">
                </div>
                
                <div class="form-group">
                    <label for="stationVolume">Default Volume</label>
                    <input type="range" id="stationVolume" min="0" max="1" step="0.1" value="0.8">
                    <span id="volumePreview">80%</span>
                </div>
                
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="stationAutoplay">
                        <label for="stationAutoplay">Enable Autoplay</label>
                    </div>
                </div>
                
                <div class="button-group" style="margin-top: 20px;">
                    <button type="button" onclick="hideAddStationModal()">Cancel</button>
                    <button type="submit" class="add-btn">Add Station</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let audioElements = [];
        let stations = [];
        let sidebarOpen = false;

        const defaultConfig = [];

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggle = document.getElementById('sidebarToggle');
            
            sidebarOpen = !sidebarOpen;
            
            if (sidebarOpen) {
                sidebar.classList.add('open');
                mainContent.classList.add('sidebar-open');
                toggle.innerHTML = '✕';
            } else {
                sidebar.classList.remove('open');
                mainContent.classList.remove('sidebar-open');
                toggle.innerHTML = '⚙️';
            }
        }

        function validateJSON() {
            const configText = document.getElementById('stationConfig').value.trim();
            const errorDiv = document.getElementById('jsonError');
            const validDiv = document.getElementById('jsonValid');
            
            try {
                if (!configText) {
                    errorDiv.style.display = 'none';
                    validDiv.style.display = 'none';
                    return false;
                }
                
                const parsed = JSON.parse(configText);
                
                if (!Array.isArray(parsed)) {
                    throw new Error('Configuration must be an array');
                }
                
                for (let i = 0; i < parsed.length; i++) {
                    const station = parsed[i];
                    if (!station.title || !station.address) {
                        throw new Error(`Station ${i + 1}: Must have "title" and "address" properties`);
                    }
                    if (station.defaultVolume !== undefined && (station.defaultVolume < 0 || station.defaultVolume > 1)) {
                        throw new Error(`Station ${i + 1}: defaultVolume must be between 0 and 1`);
                    }
                }
                
                errorDiv.style.display = 'none';
                validDiv.style.display = 'block';
                return true;
                
            } catch (error) {
                errorDiv.innerHTML = `❌ ${error.message}`;
                errorDiv.style.display = 'block';
                validDiv.style.display = 'none';
                return false;
            }
        }

        function resetToDefault() {
            document.getElementById('stationConfig').value = JSON.stringify(defaultConfig, null, 2);
            validateJSON();
            loadStations();
        }

        function loadStations() {
            if (!validateJSON()) {
                return;
            }
            
            const configText = document.getElementById('stationConfig').value.trim();
            
            try {
                stations = JSON.parse(configText);
                generateAudioSections();
                updateStatus('Stations loaded successfully!', 'success');
            } catch (error) {
                console.error('Load error:', error);
            }
        }

        function exportConfig() {
            const configText = document.getElementById('stationConfig').value;
            const blob = new Blob([configText], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'liveatc-config.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showAddStationModal() {
            document.getElementById('addStationModal').style.display = 'flex';
        }

        function hideAddStationModal() {
            document.getElementById('addStationModal').style.display = 'none';
            document.getElementById('addStationForm').reset();
            document.getElementById('volumePreview').textContent = '80%';
        }

        function addStation(stationData) {
            const currentConfig = document.getElementById('stationConfig').value.trim();
            let stations = [];
            
            try {
                if (currentConfig) {
                    stations = JSON.parse(currentConfig);
                }
            } catch (e) {
                stations = [];
            }
            
            stations.push(stationData);
            document.getElementById('stationConfig').value = JSON.stringify(stations, null, 2);
            validateJSON();
            loadStations();
            hideAddStationModal();
        }

        function generateAudioSections() {
            const container = document.getElementById('audioContainer');
            container.innerHTML = '';
            audioElements = [];

            stations.forEach((station, index) => {
                const section = document.createElement('div');
                section.className = 'audio-section';
                
                let locationStr = '';
                if (station.state && station.country) {
                    locationStr = `📍 ${station.state}, ${station.country}`;
                } else if (station.country) {
                    locationStr = `📍 ${station.country}`;
                } else if (station.state) {
                    locationStr = `📍 ${station.state}`;
                }
                
                const defaultVol = station.defaultVolume !== undefined ? Math.max(0, Math.min(1, station.defaultVolume)) : 1;
                const volumePercent = Math.round(defaultVol * 100);
                
                section.innerHTML = `
                    <div class="audio-title">
                        ${escapeHtml(station.title)}
                        ${station.autoplay ? '<span class="autoplay-indicator">AUTO</span>' : ''}
                    </div>
                    ${locationStr ? `<div class="audio-location">${locationStr}</div>` : ''}
                    <div class="audio-controls-row">
                        <button class="play-button" id="playBtn${index}" onclick="togglePlay(${index})">▶️ Play</button>
                        <audio id="audio${index}" controls preload="auto" style="flex: 1;">
                            <source src="${escapeHtml(station.address)}" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                    <div class="volume-control">
                        <span>🔊</span>
                        <input type="range" id="volume${index}" min="0" max="1" step="0.1" value="${defaultVol}">
                        <span id="volumeDisplay${index}" class="volume-display">${volumePercent}%</span>
                    </div>
                `;
                
                container.appendChild(section);
                
                const audio = document.getElementById(`audio${index}`);
                const volumeSlider = document.getElementById(`volume${index}`);
                const volumeDisplay = document.getElementById(`volumeDisplay${index}`);
                const playBtn = document.getElementById(`playBtn${index}`);
                
                audio.volume = defaultVol;
                
                audioElements.push({
                    element: audio,
                    button: playBtn,
                    autoplay: station.autoplay || false,
                    index: index
                });
                
                volumeSlider.addEventListener('input', function() {
                    audio.volume = this.value;
                    volumeDisplay.textContent = Math.round(this.value * 100) + '%';
                });
                
                audio.addEventListener('play', () => {
                    playBtn.textContent = '⏸️ Pause';
                    playBtn.classList.add('playing');
                    updateStatus();
                });
                
                audio.addEventListener('pause', () => {
                    playBtn.textContent = '▶️ Play';
                    playBtn.classList.remove('playing');
                    updateStatus();
                });
                
                audio.addEventListener('error', function() {
                    console.log(`Audio ${index} error:`, this.error);
                    playBtn.textContent = '❌ Error';
                    playBtn.disabled = true;
                });
                
                if (station.autoplay) {
                    setTimeout(() => {
                        audio.play().catch(e => console.log(`Autoplay failed for ${station.title}:`, e));
                    }, 1000 + (index * 500));
                }
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function togglePlay(index) {
            const audioObj = audioElements[index];
            const audio = audioObj.element;
            
            if (audio.paused) {
                audio.play().catch(e => console.log('Play failed:', e));
            } else {
                audio.pause();
            }
        }

        function playAll() {
            const promises = audioElements.map(audioObj => 
                audioObj.element.play().catch(e => console.log('Audio play failed:', e))
            );
            
            Promise.allSettled(promises).then(() => {
                updateStatus('🎵 Playing all available streams!', 'success');
            });
        }

        function pauseAll() {
            audioElements.forEach(audioObj => audioObj.element.pause());
            updateStatus('⏸️ All streams paused', 'warning');
        }

        function stopAll() {
            audioElements.forEach(audioObj => {
                audioObj.element.pause();
                audioObj.element.currentTime = 0;
            });
            updateStatus('⏹️ All streams stopped', 'error');
        }

        function updateStatus(message, type) {
            const status = document.getElementById('status');
            
            if (message && type) {
                status.innerHTML = message;
                setStatusStyle(status, type);
                return;
            }
            
            const playing = audioElements.filter(audioObj => !audioObj.element.paused);
            const autoplayCount = audioElements.filter(audioObj => audioObj.autoplay).length;
            
            if (playing.length === audioElements.length && audioElements.length > 0) {
                status.innerHTML = `🎵 All ${audioElements.length} streams playing`;
                setStatusStyle(status, 'success');
            } else if (playing.length > 0) {
                status.innerHTML = `🎵 ${playing.length} of ${audioElements.length} streams playing`;
                setStatusStyle(status, 'success');
            } else if (audioElements.length > 0) {
                const autoplayText = autoplayCount > 0 ? ` (${autoplayCount} set to autoplay)` : '';
                status.innerHTML = `⏸️ All streams paused${autoplayText}`;
                setStatusStyle(status, 'warning');
            } else {
                status.innerHTML = 'Configure your stations using the settings panel on the right';
                setStatusStyle(status, 'info');
            }
        }

        function setStatusStyle(element, type) {
            switch (type) {
                case 'success':
                    element.style.background = 'rgba(0, 255, 0, 0.1)';
                    element.style.borderColor = 'rgba(0, 255, 0, 0.3)';
                    break;
                case 'warning':
                    element.style.background = 'rgba(255, 165, 0, 0.1)';
                    element.style.borderColor = 'rgba(255, 165, 0, 0.3)';
                    break;
                case 'error':
                    element.style.background = 'rgba(255, 0, 0, 0.1)';
                    element.style.borderColor = 'rgba(255, 0, 0, 0.3)';
                    break;
                default:
                    element.style.background = 'rgba(0, 255, 0, 0.1)';
                    element.style.borderColor = 'rgba(0, 255, 0, 0.3)';
            }
        }

        // Event listeners
        document.getElementById('stationConfig').addEventListener('input', validateJSON);
        
        document.getElementById('stationVolume').addEventListener('input', function() {
            document.getElementById('volumePreview').textContent = Math.round(this.value * 100) + '%';
        });

        document.getElementById('addStationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const stationData = {
                title: document.getElementById('stationTitle').value,
                address: document.getElementById('stationAddress').value,
                autoplay: document.getElementById('stationAutoplay').checked,
                defaultVolume: parseFloat(document.getElementById('stationVolume').value)
            };
            
            const country = document.getElementById('stationCountry').value.trim();
            const state = document.getElementById('stationState').value.trim();
            
            if (country) stationData.country = country;
            if (state) stationData.state = state;
            
            addStation(stationData);
        });

        // Initialize
        window.addEventListener('load', function() {
            document.getElementById('stationConfig').value = JSON.stringify(defaultConfig, null, 2);
            validateJSON();
            loadStations();
        });
    </script>
</body>
</html>